# ITER_BE_2026-02-17_01

## Purpose
Handoff document for a fresh context to continue backend architecture/code improvements without re-discovery.

## Naming System (Proposed)
Use this file pattern for all iterative improvement passes:

`ITER_<SCOPE>_<YYYY-MM-DD>_<NN>.md`

- `SCOPE`: `BE`, `FE`, `GLOBAL`, `RTC`, `UX`, etc.
- `YYYY-MM-DD`: start date of the pass
- `NN`: 2-digit sequence for multiple passes on same date

Examples:
- `ITER_BE_2026-02-17_01.md`
- `ITER_BE_2026-02-17_02.md`
- `ITER_FE_2026-02-18_01.md`

### Rules
- Never rename completed iteration files.
- New pass = new file.
- Keep one stable anchor file per scope (for backend that remains `IMPROVEMENTS_BE.md`) and link to iteration files from there.
- Record only deltas in each iteration file (no full-history copy).

---

## Current Backend Delta
Date: 2026-02-17

### Already Completed In Latest Pass
- Added shared HTTP client in app state and switched captcha verification to reuse it.
- Added opportunistic stale-key sweeping for in-memory limiter maps/leases.
- Added regression test for stale limiter-key pruning.
- Moved DB schema initialization to startup bootstrap path and removed per-request handler/runtime schema init calls.
- Added startup fail-fast regression test for schema bootstrap failure path.
- Introduced auth persistence repository seam for register/login/refresh/logout with DB and in-memory implementations.
- Removed direct `if let Some(pool)` auth-flow branching from handlers by isolating backend selection to repository wiring.
- Verified behavior parity with auth-focused test coverage (including replay-detection path).
- Added bounded session/replay retention cleanup with opportunistic sweep cadence for in-memory and Postgres auth persistence paths.
- Added replay-token timestamp schema support (`used_at_unix`) for bounded Postgres replay-history pruning.
- Added deterministic cleanup tests for idempotence and replay-detection preservation.
- Removed redundant legacy membership/realtime backing-map fields from `AppState` and kept those concerns accessed via `MembershipStore` + `RealtimeRegistry` only.
- Kept decomposition coverage in `core` tests for membership/registry map access paths.
- Added deterministic hardening/perf characterization tests to confirm stale unique-key limiter traffic is swept and map growth remains bounded.
- Added deterministic replay-retention lifecycle coverage to verify cleanup cadence preserves replay detection until cutoff.

### Remaining Work (Priority Order)
- _No outstanding items recorded in this iteration file._

---

## Suggested Next Execution Sequence
1. Create next iteration file for the next backend delta slice

## Notes for Fresh Context
- Preserve security-first defaults; do not relax caps/timeouts/rate limits.
- Keep behavior-compatible changes unless explicitly approved.
- Prefer incremental, test-backed slices over broad rewrites.